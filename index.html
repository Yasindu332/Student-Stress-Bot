<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– Student Stress Bot ğŸ§ </title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .chat-container { width: 100%; max-width: 400px; background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); overflow: hidden; display: flex; flex-direction: column; height: 80vh; position: relative; }
        .chat-header { background: #0078ff; color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 1.2em; position: relative; }
        .chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px 15px; border-radius: 20px; max-width: 80%; font-size: 0.95em; line-height: 1.4; }
        .bot-message { background: #e9e9eb; color: black; align-self: flex-start; border-bottom-left-radius: 5px; }
        .user-message { background: #0078ff; color: white; align-self: flex-end; border-bottom-right-radius: 5px; }
        .input-area { padding: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; justify-content: center; background: #f9f9f9; flex-wrap: wrap; }
        .btn { padding: 10px 20px; background: #0078ff; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; transition: background 0.3s; margin: 5px; }
        .btn:hover { background: #005ecb; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .options { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
        .option-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid #0078ff; background: white; color: #0078ff; cursor: pointer; font-weight: bold; }
        .option-btn:hover { background: #0078ff; color: white; }
        .clear-btn { background: #ff4444; font-size: 0.8em; padding: 5px 10px; position: absolute; right: 10px; top: 15px; border-radius: 5px; color: white; border: none; cursor: pointer; }
        
        /* Modal Styles */
        .modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; text-align: center; width: 80%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); animation: fadeIn 0.3s; display: flex; flex-direction: column; align-items: center; }
        .modal-buttons { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
        .modal-btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-yes { background: #ff4444; color: white; }
        .btn-no { background: #ddd; color: black; }
        .modal-img { width: 80px; height: auto; margin-bottom: 15px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        ğŸ¤– Stress Bot
        <button class="clear-btn" onclick="showResetModal()" title="Clear History">ğŸ—‘ï¸ Reset</button>
    </div>
    <div class="chat-box" id="chat-box">
        </div>
    <div class="input-area" id="input-area">
        </div>

    <div id="resetModal" class="modal">
        <div class="modal-content">
            <img src="data:image/png;base64,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9OjR/3j06NH/ePTo0f949OjR/3j06NH/ePTo0f949OjR/3j06NH/ePTo0f947Nix/3Ds2LH/cOzYsf9w7Nix/3Ds2LH/cOzYsf9w/Pjx/3D8+PH/cPz48f9w/Pjx/3D8+PH/cPz48f9w/Pjx/3D8+PH/cPz48f9w/Pjx/3DixIn/cOLEif9w4sSJ/3DixIn/cOLEif9w4sSJ/3DixIn/cOLEif9w4sSJ/3DixIn/cOLEif9w6tSp/3Dq1Kn/cOrUqf9w6tSp/3Dq1Kn/cOrUqf9w6tSp/3Dq1Kn/cOrUqf9w6tSp/3Dq1Kn/cOrUqf9w+vTp/3D69On/cPr06f9w+vTp/3D69On/cPr06f9w+vTp/3D69On/cPr06f9w+vTp/3D69On/cObMmf+eM2fOvz1z5sy/PXPmzL89c+bMv82eOfNvz54582/Pnjnzb8+eOfNvz54582/Pnjnzb5988sm/ffLJJ//2ySef/Nsnn3zyb5988sm/ffLJJ//2ySef/Nsnn3zyb5988sm/ffLJJ//2ySef/Nsnn3zyb5988sm/ffrpp//26aef/tunn376b59++um/ffrpp//26aef/tunn376b59++um/ffrpp//26aef/tunn376b59++um/ffrpp//22Wef/dtzzz33t+ee+884d+7cfz/33HP/89xzz/3Pc8899z/PPffc/zz33HP/89xzz/3Pc8899z/PPffc/zz33HP/89xzz/3Pc8899z/PPffc/zz33HP/89xzz/3Pc8899z/PPffc/zz33HP/89xzz/3Pc8899z/PPffc/zz33HP/89xzz/3Pc8899z/PPffc/zz33HP/89xzz/3P/wPYb+R8a7vXoQAAAABJRU5ErkJggg==" alt="Warning" class="modal-img">
            <p id="modalText">âš ï¸ Are you sure you want to delete all history?</p>
            <div class="modal-buttons">
                <button class="modal-btn btn-yes" onclick="confirmReset()">âœ… Yes</button>
                <button class="modal-btn btn-no" onclick="closeResetModal()">âŒ No</button>
            </div>
        </div>
    </div>
</div>

<script>
    const resources = {
        en: {
            intro: "ğŸ‘‹ Hello! I can help you check your stress level. ğŸ§˜â€â™‚ï¸<br>Please select your language. ğŸŒ",
            q1: "1. ğŸ˜´ Rate your <b>Sleep Quality</b> (1-5)<br>1=Bad ğŸ˜« ... 5=Very Good ğŸ¤©",
            q2: "2. ğŸ¤• How many times a week do you suffer <b>headaches</b>?<br>1=Low ğŸ˜Œ ... 5=High ğŸ¤¯",
            q3: "3. ğŸ“š How is your <b>Academic Performance</b>?<br>1=Poor ğŸ“‰ ... 5=Excellent ğŸ†",
            q4: "4. ğŸ’ How do you feel about your <b>Study Load</b>?<br>1=Light ğŸª¶ ... 5=Heavy ğŸ‹ï¸",
            q5: "5. âš½ How many times a week do you do <b>Extracurricular Activities</b>? (1-5) ğŸ¨",
            result: "ğŸ“Š Analysis complete...<br><br><b>ğŸ¯ Your stress level: {score}/5</b><br>{comment}<br><br><b>ğŸ“‰ Trend:</b> {trend}",
            low: "âœ¨ Your stress level is <b>Low</b>. Great job! ğŸŒ¸",
            mod: "âš ï¸ Your stress level is <b>Moderate</b>. Keep an eye on it. ğŸ‘€",
            high: "ğŸš¨ Your stress level is <b>High</b>. Please take a break! ğŸ›ŒğŸ’†â€â™‚ï¸",
            restart: "ğŸ”„ Start Again",
            trend_better: "ğŸ‰ Good news! Your stress is lower than last time. ğŸ“‰",
            trend_worse: "ğŸ˜Ÿ Warning! Your stress is higher than last time. ğŸ“ˆ",
            trend_same: "âš–ï¸ Your stress level is the same as last time.",
            trend_first: "ğŸ“ This is your first record.",
            reset_confirm: "âš ï¸ Are you sure you want to delete all history? ğŸ—‘ï¸",
            reset_done: "âœ… History cleared."
        },
        si: {
            intro: "ğŸ‘‹ à¶†à¶ºà·”à¶¶à·à·€à¶±à·Š! à¶¸à¶¸ à¶”à¶¶à·š à¶†à¶­à¶­à·’ à¶¸à¶§à·Šà¶§à¶¸ (Stress Level) à¶´à¶»à·“à¶šà·Šà·‚à· à¶šà·’à¶»à·“à¶¸à¶§ à¶‹à¶¯à·€à·Š à¶šà¶»à¶±à·Šà¶±à·™à¶¸à·’. ğŸ§˜â€â™‚ï¸<br>à¶šà¶»à·”à¶«à·à¶šà¶» à¶·à·à·‚à·à·€à¶šà·Š à¶­à·à¶»à¶±à·Šà¶±. ğŸŒ",
            q1: "1. ğŸ˜´ à¶”à¶¶à·š <b>à¶±à·’à¶±à·Šà¶¯à·š à¶œà·”à¶«à·à¶­à·Šà¶¸à¶šà¶·à·à·€à¶º</b> (Sleep Quality) 1 à·ƒà·’à¶§ 5 à¶¯à¶šà·Šà·€à· à¶…à¶œà¶º à¶šà¶»à¶±à·Šà¶±.<br>5 = à¶‰à¶­à· à·„à·œà¶³à¶ºà·’ ğŸ¤©",
            q2: "2. ğŸ¤• à·ƒà¶­à·’à¶ºà¶šà¶§ à¶šà·“ à·€à¶­à·à·€à¶šà·Š à¶”à¶¶à¶§ <b>à·„à·’à·ƒà¶»à¶¯à¶º</b> (Headaches) à¶‡à¶­à·’ à·€à·šà¶¯?<br>1 = à¶‰à¶­à· à¶…à¶©à·” ğŸ˜Œ ... 5 = à¶‰à¶­à· à·€à·à¶©à·’ ğŸ¤¯",
            q3: "3. ğŸ“š à¶”à¶¶à·š <b>à¶…à¶°à·Šâ€à¶ºà·à¶´à¶± à¶šà·à¶»à·Šà¶º à·ƒà·à¶°à¶±à¶º</b> (Academic Performance) à¶šà·™à·ƒà·šà¶¯?<br>1 = à¶¯à·”à¶»à·Šà·€à¶½ ğŸ“‰ ... 5 = à¶‰à¶­à· à·„à·œà¶³ ğŸ†",
            q4: "4. ğŸ’ à¶”à¶¶à·š <b>à¶…à¶°à·Šâ€à¶ºà¶ºà¶± à¶¶à¶»</b> (Study Load) à¶”à¶¶à¶§ à¶¯à·à¶±à·™à¶±à·Šà¶±à·š à¶šà·™à·ƒà·šà¶¯?<br>1 = à·ƒà·à·„à·à¶½à·Šà¶½à·” ğŸª¶ ... 5 = à¶‰à¶­à· à¶¶à¶» ğŸ‹ï¸",
            q5: "5. âš½ à·ƒà¶­à·’à¶ºà¶šà¶§ à¶šà·“ à·€à¶­à·à·€à¶šà·Š <b>à¶¶à·à·„à·’à¶» à¶šà·Šâ€à¶»à·’à¶ºà·à¶šà·à¶»à¶šà¶¸à·Šà·€à¶½</b> (Extracurricular Activities) à¶ºà·™à¶¯à·™à¶±à·€à·à¶¯? (1-5) ğŸ¨",
            result: "ğŸ“Š à·€à·’à·à·Šà¶½à·šà·‚à¶«à¶º à¶…à·€à·ƒà¶±à·Š...<br><br><b>ğŸ¯ à¶”à¶¶à·š à¶†à¶­à¶­à·’ à¶¸à¶§à·Šà¶§à¶¸: {score}/5</b><br>{comment}<br><br><b>ğŸ“‰ à¶´à·™à¶» à·€à·à¶»à·Šà¶­à· à·ƒà·à·ƒà¶³à·“à¶¸:</b> {trend}",
            low: "âœ¨ à¶”à¶¶à·š à¶†à¶­à¶­à·’ à¶¸à¶§à·Šà¶§à¶¸ <b>à¶…à¶©à·”à¶ºà·’</b> (Low). à¶±à·’à¶ºà¶¸à¶ºà·’! ğŸŒ¸",
            mod: "âš ï¸ à¶”à¶¶à·š à¶†à¶­à¶­à·’ à¶¸à¶§à·Šà¶§à¶¸ <b>à·ƒà·à¶¸à·à¶±à·Šâ€à¶ºà¶ºà·’</b> (Moderate). ğŸ‘€",
            high: "ğŸš¨ à¶”à¶¶à·š à¶†à¶­à¶­à·’ à¶¸à¶§à·Šà¶§à¶¸ <b>à·€à·à¶©à·’à¶ºà·’</b> (High). à·€à·’à·€à·šà¶šà¶ºà¶šà·Š à¶œà·à¶±à·“à¶¸ à·ƒà·”à¶¯à·”à·ƒà·”à¶ºà·’. ğŸ›ŒğŸ’†â€â™‚ï¸",
            restart: "ğŸ”„ à¶±à·à·€à¶­ à¶´à¶§à¶±à·Š à¶œà¶±à·Šà¶±",
            trend_better: "ğŸ‰ à·„à·œà¶³à¶ºà·’! à¶šà¶½à·’à¶±à·Š à·€à¶­à·à·€à¶§ à·€à¶©à· à¶…à¶©à·”à·€à·“ à¶‡à¶­. ğŸ“‰",
            trend_worse: "ğŸ˜Ÿ à¶´à¶»à·’à·ƒà·Šà·ƒà¶¸à·Š à·€à¶±à·Šà¶±! à¶šà¶½à·’à¶±à·Š à·€à¶­à·à·€à¶§ à·€à¶©à· à·€à·à¶©à·’à·€à·“ à¶‡à¶­. ğŸ“ˆ",
            trend_same: "âš–ï¸ à¶šà¶½à·’à¶±à·Š à·€à¶­à·à·€à¶§ à·ƒà¶¸à·à¶±à¶ºà·’.",
            trend_first: "ğŸ“ à¶¸à·™à¶º à¶”à¶¶à¶œà·š à¶´à·…à¶¸à·” à¶´à¶»à·“à¶šà·Šà·‚à·à·€à¶ºà·’.",
            reset_confirm: "âš ï¸ à¶”à¶¶à¶§ à·ƒà·’à¶ºà¶½à·” à¶‰à¶­à·’à·„à·à·ƒà¶º à¶¸à·à¶šà·“à¶¸à¶§ à¶…à·€à·à·Šâ€à¶º à¶¶à·€ à·€à·’à·à·Šà·€à·à·ƒà¶¯? ğŸ—‘ï¸",
            reset_done: "âœ… à¶‰à¶­à·’à·„à·à·ƒà¶º à¶¸à¶šà· à¶¯à¶¸à¶± à¶½à¶¯à·“."
        },
        ta: {
            intro: "ğŸ‘‹ à®µà®£à®•à¯à®•à®®à¯! à®‰à®™à¯à®•à®³à¯ à®®à®© à®…à®´à¯à®¤à¯à®¤ à®…à®³à®µà¯ˆ à®šà®°à®¿à®ªà®¾à®°à¯à®•à¯à®• à®¨à®¾à®©à¯ à®‰à®¤à®µ à®®à¯à®Ÿà®¿à®¯à¯à®®à¯. ğŸ§˜â€â™‚ï¸<br>à®®à¯Šà®´à®¿à®¯à¯ˆà®¤à¯ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®µà¯à®®à¯. ğŸŒ",
            q1: "1. ğŸ˜´ à®‰à®™à¯à®•à®³à¯ <b>à®¤à¯‚à®•à¯à®•à®¤à¯à®¤à®¿à®©à¯ à®¤à®°à®¤à¯à®¤à¯ˆ</b> à®®à®¤à®¿à®ªà¯à®ªà®¿à®Ÿà®µà¯à®®à¯ (1-5).<br>5 = à®®à®¿à®• à®¨à®²à¯à®²à®¤à¯ ğŸ¤©",
            q2: "2. ğŸ¤• à®µà®¾à®°à®¤à¯à®¤à®¿à®±à¯à®•à¯ à®à®¤à¯à®¤à®©à¯ˆ à®®à¯à®±à¯ˆ <b>à®¤à®²à¯ˆà®µà®²à®¿</b> à®à®±à¯à®ªà®Ÿà¯à®•à®¿à®±à®¤à¯?<br>1 = à®®à®¿à®•à®•à¯ à®•à¯à®±à¯ˆà®µà¯ ğŸ˜Œ ... 5 = à®®à®¿à®• à®…à®¤à®¿à®•à®®à¯ ğŸ¤¯",
            q3: "3. ğŸ“š à®‰à®™à¯à®•à®³à¯ <b>à®•à®²à¯à®µà®¿à®šà¯ à®šà¯†à®¯à®²à¯à®ªà®¾à®Ÿà¯</b> à®à®ªà¯à®ªà®Ÿà®¿ à®‰à®³à¯à®³à®¤à¯?<br>1 = à®®à¯‹à®šà®®à¯ ğŸ“‰ ... 5 = à®®à®¿à®• à®¨à®©à¯à®±à¯ ğŸ†",
            q4: "4. ğŸ’ à®‰à®™à¯à®•à®³à¯ <b>à®ªà®Ÿà®¿à®ªà¯à®ªà¯à®šà¯ à®šà¯à®®à¯ˆ</b> à®ªà®±à¯à®±à®¿ à®à®©à¯à®© à®¨à®¿à®©à¯ˆà®•à¯à®•à®¿à®±à¯€à®°à¯à®•à®³à¯?<br>1 = à®•à¯à®±à¯ˆà®µà¯ ğŸª¶ ... 5 = à®…à®¤à®¿à®•à®®à¯ ğŸ‹ï¸",
            q5: "5. âš½ à®µà®¾à®°à®¤à¯à®¤à®¿à®±à¯à®•à¯ à®à®¤à¯à®¤à®©à¯ˆ à®®à¯à®±à¯ˆ <b>à®šà®¾à®°à®¾à®¤ à®šà¯†à®¯à®²à¯à®ªà®¾à®Ÿà¯à®•à®³à®¿à®²à¯</b> à®ˆà®Ÿà¯à®ªà®Ÿà¯à®•à®¿à®±à¯€à®°à¯à®•à®³à¯? (1-5) ğŸ¨",
            result: "ğŸ“Š à®ªà®•à¯à®ªà¯à®ªà®¾à®¯à¯à®µà¯ à®®à¯à®Ÿà®¿à®¨à¯à®¤à®¤à¯...<br><br><b>ğŸ¯ à®‰à®™à¯à®•à®³à¯ à®®à®© à®…à®´à¯à®¤à¯à®¤ à®…à®³à®µà¯: {score}/5</b><br>{comment}<br><br><b>ğŸ“‰ à®’à®ªà¯à®ªà¯€à®Ÿà¯:</b> {trend}",
            low: "âœ¨ à®‰à®™à¯à®•à®³à¯ à®®à®© à®…à®´à¯à®¤à¯à®¤à®®à¯ <b>à®•à¯à®±à¯ˆà®µà¯</b>. à®¨à®©à¯à®±à¯! ğŸŒ¸",
            mod: "âš ï¸ à®‰à®™à¯à®•à®³à¯ à®®à®© à®…à®´à¯à®¤à¯à®¤à®®à¯ <b>à®®à®¿à®¤à®®à®¾à®©à®¤à¯</b>. ğŸ‘€",
            high: "ğŸš¨ à®‰à®™à¯à®•à®³à¯ à®®à®© à®…à®´à¯à®¤à¯à®¤à®®à¯ <b>à®…à®¤à®¿à®•à®®à¯</b>. à®“à®¯à¯à®µà¯ à®¤à¯‡à®µà¯ˆ. ğŸ›ŒğŸ’†â€â™‚ï¸",
            restart: "ğŸ”„ à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®¤à¯Šà®Ÿà®™à¯à®•",
            trend_better: "ğŸ‰ à®¨à®²à¯à®²à®¤à¯! à®•à®Ÿà®¨à¯à®¤ à®®à¯à®±à¯ˆà®¯à¯ˆ à®µà®¿à®Ÿ à®•à¯à®±à¯ˆà®µà¯. ğŸ“‰",
            trend_worse: "ğŸ˜Ÿ à®•à®µà®©à®®à¯! à®•à®Ÿà®¨à¯à®¤ à®®à¯à®±à¯ˆà®¯à¯ˆ à®µà®¿à®Ÿ à®…à®¤à®¿à®•à®®à¯. ğŸ“ˆ",
            trend_same: "âš–ï¸ à®•à®Ÿà®¨à¯à®¤ à®®à¯à®±à¯ˆ à®ªà¯‹à®²à®µà¯‡ à®‰à®³à¯à®³à®¤à¯.",
            trend_first: "ğŸ“ à®‡à®¤à¯ à®‰à®™à¯à®•à®³à¯ à®®à¯à®¤à®²à¯ à®ªà®¤à®¿à®µà¯.",
            reset_confirm: "âš ï¸ à®à®²à¯à®²à®¾ à®µà®°à®²à®¾à®±à¯à®±à¯ˆà®¯à¯à®®à¯ à®¨à¯€à®•à¯à®• à®µà®¿à®°à¯à®®à¯à®ªà¯à®•à®¿à®±à¯€à®°à¯à®•à®³à®¾? ğŸ—‘ï¸",
            reset_done: "âœ… à®µà®°à®²à®¾à®±à¯ à®…à®´à®¿à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯."
        }
    };

    const questions = ['q1', 'q2', 'q3', 'q4', 'q5'];
    
    let currentStep = 0;
    let answers = {};
    let language = 'en';

    function addMessage(text, sender) {
        const chatBox = document.getElementById('chat-box');
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message', sender === 'bot' ? 'bot-message' : 'user-message');
        msgDiv.innerHTML = text;
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function init() {
        document.getElementById('chat-box').innerHTML = '';
        currentStep = 0;
        answers = {};
        language = 'en';
        
        addMessage("ğŸŒ Please select a language / à¶·à·à·‚à·à·€ à¶­à·à¶»à¶±à·Šà¶± / à®®à¯Šà®´à®¿à®¯à¯ˆà®¤à¯ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®µà¯à®®à¯", 'bot');
        showLanguageOptions();
    }

    function showLanguageOptions() {
        const inputArea = document.getElementById('input-area');
        inputArea.innerHTML = '';
        
        const languages = [
            { code: 'en', label: 'ğŸ‡ºğŸ‡¸ English' },
            { code: 'si', label: 'ğŸ‡±ğŸ‡° à·ƒà·’à¶‚à·„à¶½' },
            { code: 'ta', label: 'ğŸ‡±ğŸ‡° à®¤à®®à®¿à®´à¯' }
        ];

        languages.forEach(lang => {
            const btn = document.createElement('button');
            btn.classList.add('btn');
            btn.innerHTML = lang.label;
            btn.onclick = () => setLanguage(lang.code);
            inputArea.appendChild(btn);
        });
    }

    function setLanguage(lang) {
        language = lang;
        const labels = { en: "ğŸ‡ºğŸ‡¸ English", si: "ğŸ‡±ğŸ‡° à·ƒà·’à¶‚à·„à¶½", ta: "ğŸ‡±ğŸ‡° à®¤à®®à®¿à®´à¯" };
        addMessage(labels[lang], 'user');
        setTimeout(() => {
             addMessage(resources[language].intro, 'bot');
             setTimeout(() => {
                 askQuestion();
             }, 800);
        }, 500);
    }

    function askQuestion() {
        const qKey = questions[currentStep];
        addMessage(resources[language][qKey], 'bot');
        showOptions();
    }

    function showOptions() {
        const inputArea = document.getElementById('input-area');
        inputArea.innerHTML = '';
        
        const optionsDiv = document.createElement('div');
        optionsDiv.classList.add('options');
        for (let i = 1; i <= 5; i++) {
            const btn = document.createElement('button');
            btn.classList.add('option-btn');
            btn.innerText = i;
            btn.onclick = () => handleInput(i);
            optionsDiv.appendChild(btn);
        }
        inputArea.appendChild(optionsDiv);
    }

    function handleInput(value) {
        const keyMap = ['sleep', 'headache', 'academic', 'load', 'extra'];
        answers[keyMap[currentStep]] = value;

        addMessage(value.toString(), 'user');
        
        currentStep++;
        if (currentStep < questions.length) {
            setTimeout(() => {
                askQuestion();
            }, 500);
        } else {
            calculateStress();
        }
    }

    function calculateStress() {
        const intercept = 1.59;
        const w_sleep = 0.18;
        const w_head = -0.07;
        const w_acad = -0.04;
        const w_load = 0.38;
        const w_extra = -0.015;

        let score = intercept + 
                    (w_sleep * answers.sleep) + 
                    (w_head * answers.headache) + 
                    (w_acad * answers.academic) + 
                    (w_load * answers.load) + 
                    (w_extra * answers.extra);

        let roundedScore = Math.round(score);
        if (roundedScore < 1) roundedScore = 1;
        if (roundedScore > 5) roundedScore = 5;

        const history = JSON.parse(localStorage.getItem('stress_bot_history')) || [];
        const lastEntry = history.length > 0 ? history[history.length - 1] : null;
        
        let trendKey = "trend_first";
        if (lastEntry) {
            if (roundedScore < lastEntry.score) trendKey = "trend_better";
            else if (roundedScore > lastEntry.score) trendKey = "trend_worse";
            else trendKey = "trend_same";
        }

        history.push({ date: new Date().toISOString(), score: roundedScore });
        localStorage.setItem('stress_bot_history', JSON.stringify(history));

        let comment = "";
        if (roundedScore <= 2) comment = resources[language].low;
        else if (roundedScore === 3) comment = resources[language].mod;
        else comment = resources[language].high;

        const trendText = resources[language][trendKey];
        const resultText = resources[language].result
            .replace('{score}', roundedScore)
            .replace('{comment}', comment)
            .replace('{trend}', trendText);

        setTimeout(() => {
            addMessage(resultText, 'bot');
            showRestartOption();
        }, 800);
    }

    function showRestartOption() {
        const inputArea = document.getElementById('input-area');
        inputArea.innerHTML = '';
        const btn = document.createElement('button');
        btn.classList.add('btn');
        btn.innerHTML = resources[language].restart;
        btn.onclick = () => init();
        inputArea.appendChild(btn);
    }

    function showResetModal() {
        const modal = document.getElementById('resetModal');
        const text = document.getElementById('modalText');
        const langCode = language || 'en';
        text.innerHTML = resources[langCode].reset_confirm;
        modal.style.display = 'flex';
    }

    function closeResetModal() {
        document.getElementById('resetModal').style.display = 'none';
    }

    function confirmReset() {
        localStorage.removeItem('stress_bot_history');
        closeResetModal();
        alert(resources[language || 'en'].reset_done);
        init();
    }

    window.onload = init;
</script>

</body>
</html>
