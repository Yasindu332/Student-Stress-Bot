<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindMate AI Ultimate</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Noto+Sans+Sinhala:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4A90E2;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        /* Themes */
        body.model-friend { --primary-color: #FF6B6B; --bg-gradient: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); }
        body.model-teacher { --primary-color: #4A90E2; --bg-gradient: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
        body.model-zen { --primary-color: #66BB6A; --bg-gradient: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }

        body {
            font-family: 'Poppins', 'Noto Sans Sinhala', sans-serif;
            background: var(--bg-gradient);
            height: 100vh;
            overflow: hidden;
            color: #333;
            transition: background 0.5s ease;
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
        }

        /* Full Screen Container */
        .app-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .navbar {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        /* Content Area */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            /* Hide Scrollbar */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .main-content::-webkit-scrollbar { display: none; }

        /* Feature Icons */
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        /* Views */
        .view-section { display: none; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Bootstrap Modal Overrides for Glass */
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: none;
        }
        .modal-header { border-bottom: 1px solid rgba(0,0,0,0.05); }

        /* Tic Tac Toe */
        .ttt-cell {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            color: var(--primary-color);
            transition: 0.2s;
        }
        .ttt-cell:hover { background: #e9ecef; }
        .ttt-cell.taken { background: #dee2e6; cursor: not-allowed; }

        /* Animations */
        @keyframes breathe { 0%,100% {transform:scale(1)} 50% {transform:scale(1.5)} }
        
        /* Floating Emoji */
        .floating-emoji { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%,100% {transform:translateY(0)} 50% {transform:translateY(-10px)} }

    </style>
</head>
<body class="model-friend">

    <div class="app-container">
        <nav class="navbar navbar-light fixed-top shadow-sm glass">
            <div class="container-fluid">
                <button class="btn btn-light rounded-circle shadow-sm" onclick="goHome()"><i class="fas fa-home text-primary"></i></button>
                <span class="navbar-brand mb-0 h1 fw-bold text-primary mx-auto">MindMate AI</span>
                <button class="btn btn-light rounded-circle shadow-sm" onclick="showModal('modelsModal')"><i class="fas fa-robot text-primary"></i></button>
            </div>
        </nav>

        <main class="main-content container pt-5 mt-4">
            
            <div id="view-home" class="view-section active text-center">
                <div class="py-4">
                    <h1 id="greet" class="fw-bold mb-2">Hi Student! üëã</h1>
                    <span id="model-disp" class="badge bg-white text-dark shadow-sm px-3 py-2 rounded-pill">Current: Friend</span>
                </div>

                <div class="d-grid gap-2 col-lg-6 mx-auto mb-4">
                    <button class="btn btn-primary btn-lg shadow rounded-pill p-3 fw-bold" onclick="startCheckup()" id="btn-start">
                        <i class="fas fa-stethoscope me-2"></i> Start Analysis
                    </button>
                </div>

                <div class="row g-3">
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('gameModal')">
                            <i class="fas fa-gamepad feature-icon"></i>
                            <span class="fw-bold d-block" id="l_game">Tic Tac AI</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('todoModal')">
                            <i class="fas fa-check-square feature-icon"></i>
                            <span class="fw-bold d-block" id="l_todo">Tasks</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('timerModal')">
                            <i class="fas fa-clock feature-icon"></i>
                            <span class="fw-bold d-block" id="l_timer">Pomodoro</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('sleepModal')">
                            <i class="fas fa-moon feature-icon"></i>
                            <span class="fw-bold d-block" id="l_sleep">Sleep Calc</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('journalModal')">
                            <i class="fas fa-book feature-icon"></i>
                            <span class="fw-bold d-block" id="l_journal">Journal</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('drawModal')">
                            <i class="fas fa-paint-brush feature-icon"></i>
                            <span class="fw-bold d-block" id="l_draw">Draw</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('breathModal')">
                            <i class="fas fa-wind feature-icon"></i>
                            <span class="fw-bold d-block" id="l_breath">Breathe</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('bmiModal')">
                            <i class="fas fa-weight feature-icon"></i>
                            <span class="fw-bold d-block" id="l_bmi">BMI</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('examModal')">
                            <i class="fas fa-calendar-day feature-icon"></i>
                            <span class="fw-bold d-block" id="l_exam">Exam</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card glass-card h-100 text-center p-3" onclick="showModal('settingsModal')">
                            <i class="fas fa-language feature-icon"></i>
                            <span class="fw-bold d-block" id="l_lang">Language</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-quiz" class="view-section container" style="max-width: 600px;">
                <div class="card glass-card shadow p-4 text-center">
                    <div class="d-flex justify-content-center align-items-center mb-3">
                        <h4 id="q-text" class="fw-bold mb-0 me-2">Question?</h4>
                        <button class="btn btn-sm btn-outline-primary rounded-circle" onclick="speakQ()"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="display-1 floating-emoji mb-4">ü§î</div>
                    
                    <p class="text-muted small">0 = No / 5 = Very Much</p>
                    <div class="row g-2">
                        <div class="col-2"><button class="btn btn-outline-dark w-100 py-3 fw-bold" onclick="answer(0)">0</button></div>
                        <div class="col-2"><button class="btn btn-outline-dark w-100 py-3 fw-bold" onclick="answer(1)">1</button></div>
                        <div class="col-2"><button class="btn btn-outline-dark w-100 py-3 fw-bold" onclick="answer(2)">2</button></div>
                        <div class="col-2"><button class="btn btn-outline-dark w-100 py-3 fw-bold" onclick="answer(3)">3</button></div>
                        <div class="col-2"><button class="btn btn-outline-dark w-100 py-3 fw-bold" onclick="answer(4)">4</button></div>
                        <div class="col-2"><button class="btn btn-outline-dark w-100 py-3 fw-bold" onclick="answer(5)">5</button></div>
                    </div>
                </div>
            </div>

            <div id="view-result" class="view-section container text-center" style="max-width: 600px;">
                <div class="card glass-card shadow p-5">
                    <h1 class="display-1 fw-bold text-primary" id="res-score">0%</h1>
                    <h3 class="mb-4" id="res-status">Normal</h3>
                    <div class="alert alert-light border shadow-sm text-start" id="res-advice">
                        Advice loading...
                    </div>
                    <button class="btn btn-primary btn-lg rounded-pill mt-3" onclick="goHome()" id="btn-home">Back Home</button>
                </div>
            </div>

        </main>
    </div>

    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="h_lang">Language</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body d-grid gap-2">
                    <button class="btn btn-outline-primary" onclick="setLang('en')">English</button>
                    <button class="btn btn-outline-primary" onclick="setLang('si')">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</button>
                    <button class="btn btn-outline-primary" onclick="setLang('ta')">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modelsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="h_models">Select AI Model</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="txt-model-inst" class="text-muted small">Choose your advisor:</p>
                    <div class="d-grid gap-2">
                        <button class="btn btn-danger text-white p-3 text-start" onclick="setModel('friend')"><i class="fas fa-user-friends me-2"></i> <span id="m-friend">Friend</span></button>
                        <button class="btn btn-primary text-white p-3 text-start" onclick="setModel('teacher')"><i class="fas fa-chalkboard-teacher me-2"></i> <span id="m-teacher">Teacher</span></button>
                        <button class="btn btn-success text-white p-3 text-start" onclick="setModel('zen')"><i class="fas fa-spa me-2"></i> <span id="m-zen">Zen Master</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="gameModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header">
                    <h5 class="modal-title" id="h_game">Tic Tac Toe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h4 id="ttt-msg" class="mb-3 text-primary">Your Turn (X)</h4>
                    <div class="row g-2 justify-content-center" style="max-width: 300px; margin: auto;" id="ttt-board">
                        </div>
                    <button class="btn btn-primary mt-3" onclick="initTTT()" id="btn-restart">Restart</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="todoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="h_todo">Tasks</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="t-in" placeholder="New Task...">
                        <button class="btn btn-primary" onclick="addTodo()">+</button>
                    </div>
                    <div id="t-list" class="list-group"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="timerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header"><h5 class="modal-title" id="h_timer">Pomodoro</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <h1 class="display-1 fw-bold my-4" id="time-disp">25:00</h1>
                    <div class="d-flex justify-content-center gap-2">
                        <button class="btn btn-success px-4" onclick="startTimer()">Start</button>
                        <button class="btn btn-danger px-4" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="sleepModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="h_sleep">Sleep Calc</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body text-center">
                    <p>I need to wake up at:</p>
                    <input type="time" class="form-control form-control-lg mb-3" id="wake-time">
                    <button class="btn btn-primary w-100" onclick="calcSleep()">Calculate Bedtime</button>
                    <h3 class="mt-3 text-primary" id="sleep-res"></h3>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="journalModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="h_journal">Journal</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <textarea class="form-control mb-3" id="j-txt" rows="10" placeholder="Dear Diary..."></textarea>
                    <button class="btn btn-primary w-100" onclick="alert('Saved!')">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="drawModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="h_draw">Canvas</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-0 position-relative">
                    <canvas id="canvas" class="w-100 h-100 bg-white"></canvas>
                    <button class="btn btn-danger position-absolute bottom-0 start-50 translate-middle-x mb-4" onclick="clearCanvas()">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="breathModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header"><h5 class="modal-title" id="h_breath">Breathe</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div style="width:150px;height:150px;background:var(--primary-color);border-radius:50%;margin:50px auto;animation:breathe 4s infinite;"></div>
                    <p class="text-muted">Inhale... Exhale...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="bmiModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">BMI</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="number" class="form-control mb-2" id="w" placeholder="Weight (kg)">
                    <input type="number" class="form-control mb-3" id="h" placeholder="Height (cm)">
                    <button class="btn btn-primary w-100" onclick="calcBMI()">Check</button>
                    <h3 class="text-center mt-3" id="bmi-res"></h3>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="examModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="h_exam">Exam Day</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="date" class="form-control mb-3" id="e-date">
                    <button class="btn btn-primary w-100" onclick="calcExam()">Calculate Days</button>
                    <h2 class="text-center mt-3" id="e-res"></h2>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- DATA & TRANSLATIONS ---
        const dict = {
            en: {
                greet:"Hi Student! üëã", btn_start:"Start Analysis", btn_home:"Home",
                l_game:"Tic Tac AI", l_todo:"Tasks", l_timer:"Pomodoro", l_sleep:"Sleep", l_journal:"Journal", l_draw:"Draw", l_breath:"Breathe", l_bmi:"BMI", l_exam:"Exam", l_lang:"Language",
                h_models:"Select Model", txt_model_inst:"Choose advisor:", m_friend:"Friend (Kind)", m_teacher:"Teacher (Strict)", m_zen:"Zen (Calm)",
                h_game:"Tic Tac Toe", h_todo:"Tasks", h_timer:"Timer", h_sleep:"Sleep", h_journal:"Journal", h_draw:"Draw", h_breath:"Breathe", h_exam:"Exam", h_lang:"Language",
                q_arr: ["Kindly rate your Sleep Quality? üò¥", "How many times a week do you suffer headaches? ü§ï", "How would you rate your Academic Performance? üìä", "How would you rate your Study Load? üìö", "How often do you practice Extracurricular Activities? ‚öΩ"],
                res_norm:"Normal", res_stress:"High Stress",
                adv_f_good:"Awesome! You're balancing life well! üéâ", adv_f_bad:"Oh no! Looks like you need a break. Call me? ü§ó",
                adv_t_good:"Satisfactory performance. Maintain this. üìö", adv_t_bad:"Critical stress levels detected. Re-structure your plan. üìè",
                adv_z_good:"Your mind is clear. Like a calm lake. üå∏", adv_z_bad:"Turbulence detected. Breathe deeply. üßò",
                ttt_turn:"Your Turn (X)", ttt_win:"You Win!", ttt_lose:"AI Wins!", ttt_draw:"Draw!", btn_restart:"Restart"
            },
            si: {
                greet:"‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä! üëã", btn_start:"‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±", btn_home:"‡∂∏‡∑î‡∂Ω‡∑ä ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä",
                l_game:"‡∂ß‡∑í‡∂ö‡∑ä ‡∂ß‡∑ê‡∂ö‡∑ä", l_todo:"‡∑Ä‡∑ê‡∂©", l_timer:"‡∂ß‡∂∫‡∑í‡∂∏‡∂ª‡∑ä", l_sleep:"‡∂±‡∑í‡∂±‡∑ä‡∂Ø", l_journal:"‡∂Ø‡∑í‡∂±‡∂¥‡∑ú‡∂≠", l_draw:"‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª", l_breath:"‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏", l_bmi:"BMI", l_exam:"‡∑Ä‡∑í‡∂∑‡∑è‡∂ú", l_lang:"‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä",
                h_models:"AI ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±", txt_model_inst:"‡∂ã‡∂¥‡∂Ø‡∑ô‡∑É‡∑ä ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±‡∑ö:", m_friend:"‡∂∫‡∑è‡∂Ω‡∑î‡∑Ä‡∑è", m_teacher:"‡∂ú‡∑î‡∂ª‡∑î‡∑Ä‡∂ª‡∂∫‡∑è", m_zen:"Zen ‡∂ú‡∑î‡∂ª‡∑î",
                h_game:"‡∂ß‡∑í‡∂ö‡∑ä ‡∂ß‡∑ê‡∂ö‡∑ä ‡∂ß‡∑ù", h_todo:"‡∑Ä‡∑ê‡∂© ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä", h_timer:"‡∂ß‡∂∫‡∑í‡∂∏‡∂ª‡∑ä", h_sleep:"‡∂±‡∑í‡∂±‡∑ä‡∂Ø", h_journal:"‡∂Ø‡∑í‡∂±‡∂¥‡∑ú‡∂≠", h_draw:"‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª", h_breath:"‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏", h_exam:"‡∑Ä‡∑í‡∂∑‡∑è‡∂ú", h_lang:"‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä",
                q_arr: ["‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂î‡∂∂‡∑ö ‡∂±‡∑í‡∂±‡∑ä‡∂Ø‡∑ö ‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∂Ö‡∂ú‡∂∫‡∂±‡∑ä‡∂±? üò¥", "‡∑É‡∂≠‡∑í‡∂∫‡∂ö‡∂ß ‡∂ö‡∑ì ‡∑Ä‡∂≠‡∑è‡∑Ä‡∂ö‡∑ä ‡∑Ñ‡∑í‡∑É‡∂ª‡∂Ø‡∂∫ ‡∂á‡∂≠‡∑í ‡∑Ä‡∑ö‡∂Ø? ü§ï", "‡∂î‡∂∂‡∑ö ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂± ‡∂ö‡∑è‡∂ª‡∑ä‡∂∫ ‡∑É‡∑è‡∂∞‡∂±‡∂∫ ‡∂ö‡∑ô‡∑É‡∑ö‡∂Ø? üìä", "‡∂î‡∂∂‡∑ö ‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∂∂‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∑ú‡∑Ñ‡∑ú‡∂∏‡∂Ø? üìö", "‡∂∂‡∑è‡∑Ñ‡∑í‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∂ö‡∂∏‡∑ä‡∑Ä‡∂Ω ‡∂ö‡∑ú‡∂¥‡∂∏‡∂´ ‡∂∫‡∑ô‡∂Ø‡∑ô‡∂±‡∑Ä‡∑è‡∂Ø? ‚öΩ"],
                res_norm:"‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‚Äç‡∂∫‡∂∫‡∑í", res_stress:"‡∂Ü‡∂≠‡∂≠‡∑í‡∂∫",
                adv_f_good:"‡∂±‡∑í‡∂∫‡∂∏‡∂∫‡∑í! ‡∂î‡∂∫‡∑è ‡∑Ñ‡∑ú‡∂≥‡∑í‡∂±‡∑ä ‡∂¥‡∑è‡∂Ω‡∂±‡∂∫ ‡∂ö‡∂ª‡∂ú‡∑ô‡∂± ‡∂∫‡∂±‡∑Ä‡∑è! üéâ", adv_f_bad:"‡∂Ö‡∂∫‡∑í‡∂∫‡∑ù! ‡∂î‡∂∫‡∑è‡∂ß ‡∑Ä‡∑í‡∑Ä‡∑ö‡∂ö‡∂∫‡∂ö‡∑ä ‡∂ï‡∂±‡∑ö ‡∑Ä‡∂ú‡∑ö. ‡∂Ö‡∂¥‡∑í ‡∂ö‡∂≠‡∑è ‡∂ö‡∂ª‡∂∏‡∑î. ü§ó",
                adv_t_good:"‡∑Ñ‡∑ú‡∂≥‡∂∫‡∑í. ‡∂Ø‡∑í‡∂ú‡∂ß‡∂∏ ‡∂∏‡∑ö ‡∑Ä‡∑í‡∂Ø‡∑í‡∑Ñ‡∂ß ‡∑Ä‡∑ê‡∂© ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. üìö", adv_t_bad:"‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∂∂‡∂ª‡∂¥‡∂≠‡∂Ω‡∂∫‡∑í. ‡∂ö‡∑è‡∂Ω‡∑É‡∂ß‡∑Ñ‡∂± ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. üìè",
                adv_z_good:"‡∂∏‡∂±‡∑É ‡∂â‡∂≠‡∑è ‡∑É‡∑ê‡∑Ñ‡∑ê‡∂Ω‡∑ä‡∂Ω‡∑î‡∂∫‡∑í. üå∏", adv_z_bad:"‡∂ö‡∂Ω‡∂∂‡∂Ω ‡∑Ä‡∑ô‡∂±‡∑ä‡∂± ‡∂ë‡∂¥‡∑è. ‡∂ú‡∑ê‡∂π‡∑î‡∂ª‡∑í‡∂±‡∑ä ‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏ ‡∂ú‡∂±‡∑ä‡∂±. üßò",
                ttt_turn:"‡∂î‡∂∂‡∑ö ‡∑Ä‡∑è‡∂ª‡∂∫", ttt_win:"‡∂î‡∂∂ ‡∂Ø‡∑í‡∂±‡∑î‡∑Ä‡∑è!", ttt_lose:"AI ‡∂Ø‡∑í‡∂±‡∑î‡∑Ä‡∑è!", ttt_draw:"‡∑É‡∂∏‡∂∫‡∑í!", btn_restart:"‡∂±‡∑ê‡∑Ä‡∂≠"
            },
            ta: {
                greet:"‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! üëã", btn_start:"‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç", btn_home:"‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ",
                l_game:"‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ", l_todo:"‡Æµ‡Øá‡Æ≤‡Øà", l_timer:"‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç", l_sleep:"‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç", l_journal:"‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ", l_draw:"‡Æì‡Æµ‡Æø‡ÆØ‡ÆÆ‡Øç", l_breath:"‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ", l_bmi:"BMI", l_exam:"‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", l_lang:"‡ÆÆ‡Øä‡Æ¥‡Æø",
                h_models:"AI ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", txt_model_inst:"‡ÆÜ‡Æ≤‡Øã‡Æö‡Æï‡Æ∞‡Øç:", m_friend:"‡Æ®‡Æ£‡Øç‡Æ™‡Æ∞‡Øç", m_teacher:"‡ÆÜ‡Æö‡Æø‡Æ∞‡Æø‡ÆØ‡Æ∞‡Øç", m_zen:"‡Æú‡ØÜ‡Æ©‡Øç",
                h_game:"‡Æü‡Æø‡Æï‡Øç ‡Æü‡Ææ‡Æï‡Øç ‡Æü‡Øã", h_todo:"‡Æµ‡Øá‡Æ≤‡Øà‡Æï‡Æ≥‡Øç", h_timer:"‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç", h_sleep:"‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç", h_journal:"‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ", h_draw:"‡Æì‡Æµ‡Æø‡ÆØ‡ÆÆ‡Øç", h_breath:"‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ", h_exam:"‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", h_lang:"‡ÆÆ‡Øä‡Æ¥‡Æø",
                q_arr: ["‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø? üò¥", "‡Æ§‡Æ≤‡Øà‡Æµ‡Æ≤‡Æø ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡Ææ? ü§ï", "‡Æï‡Æ≤‡Øç‡Æµ‡Æø ‡Æ®‡Æø‡Æ≤‡Øà? üìä", "‡Æ™‡Æü‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æö‡ØÅ‡ÆÆ‡Øà? üìö", "‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ? ‚öΩ"],
                res_norm:"‡Æö‡Ææ‡Æ§‡Ææ‡Æ∞‡Æ£‡ÆÆ‡Øç", res_stress:"‡ÆÖ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç",
                adv_f_good:"‡Æ®‡Æ©‡Øç‡Æ±‡ØÅ! ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡Ææ‡Æï‡Æö‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç! üéâ", adv_f_bad:"‡Æï‡Æµ‡Æ≤‡Øà ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡Ææ‡ÆÆ‡Øç. ‡Æì‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æé‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. ü§ó",
                adv_t_good:"‡Æ®‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ. ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ™‡Æü‡Æø‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. üìö", adv_t_bad:"‡Æï‡Æµ‡Æ©‡ÆÆ‡Øç ‡Æ§‡Øá‡Æµ‡Øà. ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà‡ÆØ‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç. üìè",
                adv_z_good:"‡ÆÆ‡Æ©‡ÆÆ‡Øç ‡ÆÖ‡ÆÆ‡Øà‡Æ§‡Æø‡ÆØ‡Ææ‡Æï ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ. üå∏", adv_z_bad:"‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ‡Æ™‡Øç ‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. üßò",
                ttt_turn:"‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æ±‡Øà", ttt_win:"‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø!", ttt_lose:"AI ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø!", ttt_draw:"‡Æö‡ÆÆ‡ÆÆ‡Øç!", btn_restart:"‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç"
            }
        };

        let lang = 'en';
        let currentModel = 'friend';
        let qAnswers = [];
        let tttBoard = Array(9).fill(null);
        let tttActive = true;

        // --- HELPER FUNCTIONS ---
        function showModal(id) { new bootstrap.Modal(document.getElementById(id)).show(); if(id=='gameModal') initTTT(); }
        function goHome() { 
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-home').classList.add('active');
        }
        function changeView(id) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- LANGUAGE & MODELS ---
        function setLang(l) {
            lang = l;
            let d = dict[l];
            document.getElementById('greet').innerText = d.greet;
            document.getElementById('btn-start').innerText = d.btn_start;
            document.getElementById('btn-home').innerText = d.btn_home;
            
            // Loop IDS
            ['game','todo','timer','sleep','journal','draw','breath','bmi','exam','lang'].forEach(k => { if(document.getElementById('l_'+k)) document.getElementById('l_'+k).innerText = d['l_'+k]; });
            ['game','todo','timer','sleep','journal','draw','breath','exam','lang','models'].forEach(k => { if(document.getElementById('h_'+k)) document.getElementById('h_'+k).innerText = d['h_'+k]; });
            
            document.getElementById('txt-model-inst').innerText = d.txt_model_inst;
            document.getElementById('m-friend').innerText = d.m_friend;
            document.getElementById('m-teacher').innerText = d.m_teacher;
            document.getElementById('m-zen').innerText = d.m_zen;
            document.getElementById('ttt-msg').innerText = d.ttt_turn;
            document.getElementById('btn-restart').innerText = d.btn_restart;
            
            // Close modal using bootstrap API
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
        }

        function setModel(m) {
            currentModel = m;
            document.body.className = 'model-' + m;
            let d = dict[lang];
            let name = m==='friend'?d.m_friend : m==='teacher'?d.m_teacher : d.m_zen;
            document.getElementById('model-disp').innerText = "Current: " + name;
            bootstrap.Modal.getInstance(document.getElementById('modelsModal')).hide();
        }

        // --- QUIZ & LOGIC ---
        let qStep = 0;
        function startCheckup() { qStep=0; qAnswers=[]; changeView('view-quiz'); loadQ(); }
        function loadQ() { document.getElementById('q-text').innerText = dict[lang].q_arr[qStep]; }
        function speakQ() { 
            let u = new SpeechSynthesisUtterance(document.getElementById('q-text').innerText);
            window.speechSynthesis.speak(u);
        }
        function answer(v) {
            qAnswers.push(v); qStep++;
            if(qStep<5) loadQ(); else finishQuiz();
        }
        function finishQuiz() {
            changeView('view-result');
            // Logic: Sleep/Extra(good=high) -> reverse. Headache/Load(bad=high) -> keep. Academic(good=high) -> reverse.
            // Simplified logic as per user request history: Sleep(0=bad), Headache(5=bad)
            // Let's assume standard stress scale: High input = High intensity.
            // Sleep(High=Good), so input 5 reduces stress.
            // Headache(High=Bad), input 5 increases stress.
            // Let's stick to dataset logic:
            let s = (5-qAnswers[0]) + qAnswers[1] + (5-qAnswers[2]) + qAnswers[3] + (5-qAnswers[4]);
            let pct = Math.round((s/25)*100);
            
            document.getElementById('res-score').innerText = pct + "%";
            let d = dict[lang];
            let good = pct < 50;
            
            let advice = "";
            if(currentModel==='friend') advice = good ? d.adv_f_good : d.adv_f_bad;
            else if(currentModel==='teacher') advice = good ? d.adv_t_good : d.adv_t_bad;
            else advice = good ? d.adv_z_good : d.adv_z_bad;
            
            document.getElementById('res-status').innerText = good ? d.res_norm : d.res_stress;
            document.getElementById('res-advice').innerText = advice;
        }

        // --- TIC TAC TOE AI ---
        function initTTT() { tttBoard.fill(null); tttActive=true; renderTTT(); document.getElementById('ttt-msg').innerText = dict[lang].ttt_turn; }
        function renderTTT() {
            let b = document.getElementById('ttt-board'); b.innerHTML = '';
            tttBoard.forEach((c, i) => {
                let col = document.createElement('div'); col.className='col-4';
                col.innerHTML = `<div class="ttt-cell shadow-sm ${c?'taken':''}" onclick="playTTT(${i})">${c || ''}</div>`;
                b.appendChild(col);
            });
        }
        function playTTT(i) {
            if(!tttActive || tttBoard[i]) return;
            tttBoard[i] = 'X'; renderTTT();
            if(checkWin('X')) { endGame(dict[lang].ttt_win); return; }
            if(!tttBoard.includes(null)) { endGame("Draw!"); return; }
            setTimeout(aiMove, 500);
        }
        function aiMove() {
            if(!tttActive) return;
            let empty = tttBoard.map((v, i) => v===null ? i : null).filter(v => v!==null);
            if(empty.length>0) {
                tttBoard[empty[Math.floor(Math.random()*empty.length)]] = 'O';
                renderTTT();
                if(checkWin('O')) endGame(dict[lang].ttt_lose);
            }
        }
        function checkWin(p) { return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(c => tttBoard[c[0]]==p && tttBoard[c[1]]==p && tttBoard[c[2]]==p); }
        function endGame(msg) { tttActive=false; document.getElementById('ttt-msg').innerText = msg; }

        // --- FEATURES ---
        function addTodo() { 
            let v=document.getElementById('t-in').value; 
            if(v) {
                document.getElementById('t-list').innerHTML += `<div class="list-group-item d-flex justify-content-between align-items-center">${v} <button class="btn btn-sm btn-danger" onclick="this.parentElement.remove()">&times;</button></div>`;
                document.getElementById('t-in').value='';
            }
        }
        
        let tInt, tTime=1500;
        function startTimer() { if(!tInt) tInt=setInterval(()=>{ tTime--; let m=Math.floor(tTime/60),s=tTime%60; document.getElementById('time-disp').innerText=`${m}:${s<10?'0'+s:s}`; if(tTime<=0)resetTimer(); },1000); }
        function resetTimer() { clearInterval(tInt); tInt=null; tTime=1500; document.getElementById('time-disp').innerText="25:00"; }
        
        function calcSleep() { 
            let t=document.getElementById('wake-time').value; 
            if(t) { 
                let d=new Date("2000-01-01 "+t); d.setMinutes(d.getMinutes()-450); 
                document.getElementById('sleep-res').innerText = "Bedtime: " + d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); 
            } 
        }
        
        function calcBMI() { 
            let w=document.getElementById('w').value, h=document.getElementById('h').value; 
            if(w&&h) document.getElementById('bmi-res').innerText = "BMI: " + (w/((h/100)**2)).toFixed(1); 
        }
        
        function calcExam() { 
            let d=new Date(document.getElementById('e-date').value); 
            let diff=Math.ceil((d-new Date())/(1000*60*60*24)); 
            document.getElementById('e-res').innerText = diff + " Days Left!"; 
        }

        // --- CANVAS ---
        const cvs = document.getElementById('canvas');
        const ctx = cvs.getContext('2d');
        let painting = false;
        
        function resizeCanvas() { cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight; }
        // Resize on modal show
        document.getElementById('drawModal').addEventListener('shown.bs.modal', resizeCanvas);

        function getPos(e) {
            let r = cvs.getBoundingClientRect();
            return { x: (e.clientX||e.touches[0].clientX)-r.left, y: (e.clientY||e.touches[0].clientY)-r.top };
        }
        function startDraw(e) { e.preventDefault(); painting=true; draw(e); }
        function endDraw() { painting=false; ctx.beginPath(); }
        function draw(e) {
            if(!painting) return;
            e.preventDefault();
            let p = getPos(e);
            ctx.lineWidth=3; ctx.lineCap='round'; 
            ctx.lineTo(p.x, p.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(p.x, p.y);
        }
        
        cvs.addEventListener('mousedown', startDraw); cvs.addEventListener('touchstart', startDraw);
        cvs.addEventListener('mouseup', endDraw); cvs.addEventListener('touchend', endDraw);
        cvs.addEventListener('mousemove', draw); cvs.addEventListener('touchmove', draw);
        
        function clearCanvas() { ctx.clearRect(0,0,cvs.width,cvs.height); }

    </script>
</body>
</html>
