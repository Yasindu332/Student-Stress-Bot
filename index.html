<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindMate AI Final</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Noto+Sans+Sinhala:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4A90E2;
            --bg-grad: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.9);
            --text: #333;
        }

        body.model-friend { --primary: #FF6B6B; --bg-grad: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); }
        body.model-teacher { --primary: #4A90E2; --bg-grad: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        body.model-zen { --primary: #66BB6A; --bg-grad: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }

        body {
            font-family: 'Poppins', 'Noto Sans Sinhala', sans-serif;
            margin: 0; background: var(--bg-grad); color: var(--text);
            height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center;
            transition: background 0.5s;
        }

        .app {
            width: 100%; height: 100%; background: rgba(255,255,255,0.25);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            display: flex; flex-direction: column; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        @media (min-width: 600px) { .app { width: 400px; height: 90vh; border-radius: 30px; border: 1px solid rgba(255,255,255,0.4); } }

        .header {
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.6); border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); letter-spacing: 1px; }
        .icon-btn { background: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: 0.2s; }
        .icon-btn:hover { transform: scale(1.1); }

        .content { flex: 1; overflow-y: auto; padding: 20px; scrollbar-width: none; }
        .content::-webkit-scrollbar { display: none; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding-bottom: 50px; }
        .card {
            background: var(--card-bg); border-radius: 15px; padding: 20px; text-align: center;
            cursor: pointer; transition: 0.2s; border: 1px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .card i { font-size: 2rem; color: var(--primary); margin-bottom: 10px; display: block; }
        .card span { font-weight: 600; font-size: 0.9rem; }

        .btn-main {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: var(--primary); color: white; font-weight: bold; font-size: 1rem;
            cursor: pointer; margin-top: 10px; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-main:active { transform: scale(0.98); }

        .modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #f4f7f6; z-index: 100; display: none; flex-direction: column;
        }
        .modal-head {
            padding: 20px; background: white; font-weight: bold; font-size: 1.1rem;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .modal-body { flex: 1; padding: 20px; overflow-y: auto; }

        input, textarea {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;
            margin-bottom: 10px; font-family: inherit; font-size: 1rem; box-sizing: border-box;
        }

        .view { display: none; animation: fadeIn 0.4s; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .ttt-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 250px; margin: 20px auto; }
        .ttt-cell {
            aspect-ratio: 1; background: white; border-radius: 10px;
            font-size: 2.5rem; font-weight: bold; color: var(--primary);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .todo-item { background: white; padding: 10px; border-radius: 8px; margin-bottom: 5px; display:flex; justify-content:space-between; align-items:center; }
    </style>
</head>
<body class="model-friend">

<div class="app">
    <div class="header">
        <button class="icon-btn" onclick="goHome()"><i class="fas fa-home"></i></button>
        <div class="logo">MindMate</div>
        <button class="icon-btn" onclick="openModal('models')"><i class="fas fa-robot"></i></button>
    </div>

    <div class="content">
        <div id="view-home" class="view active">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 id="greet">Hi Student! üëã</h2>
                <p id="model-disp" style="font-size: 0.8rem; background: rgba(255,255,255,0.5); padding: 5px 10px; border-radius: 20px; display: inline-block;">Current: Friend</p>
                <button class="btn-main" onclick="startCheckup()" id="btn-start">Start Analysis</button>
            </div>

            <div class="grid">
                <div class="card" onclick="openModal('game')"><i class="fas fa-gamepad"></i><span id="l_game">Tic Tac AI</span></div>
                <div class="card" onclick="openModal('todo')"><i class="fas fa-check-square"></i><span id="l_todo">Tasks</span></div>
                <div class="card" onclick="openModal('timer')"><i class="fas fa-clock"></i><span id="l_timer">Pomodoro</span></div>
                <div class="card" onclick="openModal('sleep')"><i class="fas fa-moon"></i><span id="l_sleep">Sleep Calc</span></div>
                <div class="card" onclick="openModal('journal')"><i class="fas fa-book"></i><span id="l_journal">Journal</span></div>
                <div class="card" onclick="openModal('draw')"><i class="fas fa-paint-brush"></i><span id="l_draw">Draw</span></div>
                <div class="card" onclick="openModal('breath')"><i class="fas fa-wind"></i><span id="l_breath">Breathe</span></div>
                <div class="card" onclick="openModal('bmi')"><i class="fas fa-weight"></i><span id="l_bmi">BMI</span></div>
                <div class="card" onclick="openModal('exam')"><i class="fas fa-calendar-day"></i><span id="l_exam">Exam</span></div>
                <div class="card" onclick="openModal('settings')"><i class="fas fa-language"></i><span id="l_lang">Language</span></div>
            </div>
        </div>

        <div id="view-quiz" class="view">
            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center;">
                <div style="display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:15px;">
                    <h2 id="q-text" style="font-size:1.1rem; margin:0;">Question</h2>
                    <i class="fas fa-volume-up" style="color:var(--primary); cursor:pointer;" onclick="speakQ()"></i>
                </div>
                <div style="font-size: 3rem; margin-bottom: 20px;">ü§î</div>
                
                <div style="display:grid; grid-template-columns: repeat(6,1fr); gap:5px;">
                    <button class="btn-main" style="margin:0; padding:10px; background:#e0e0e0; color:#333;" onclick="answer(0)">0</button>
                    <button class="btn-main" style="margin:0; padding:10px; background:#d0d0d0; color:#333;" onclick="answer(1)">1</button>
                    <button class="btn-main" style="margin:0; padding:10px; background:#c0c0c0; color:#333;" onclick="answer(2)">2</button>
                    <button class="btn-main" style="margin:0; padding:10px; background:#b0b0b0; color:#333;" onclick="answer(3)">3</button>
                    <button class="btn-main" style="margin:0; padding:10px; background:#a0a0a0; color:white;" onclick="answer(4)">4</button>
                    <button class="btn-main" style="margin:0; padding:10px; background:#909090; color:white;" onclick="answer(5)">5</button>
                </div>
                <p style="margin-top:10px; font-size:0.8rem; color:#666;">0 = No | 5 = Very Much</p>
            </div>
        </div>

        <div id="view-result" class="view" style="text-align:center;">
            <div style="background: white; padding: 30px; border-radius: 20px;">
                <h1 id="res-score" style="color:var(--primary); font-size:3.5rem;">0%</h1>
                <h3 id="res-status">Normal</h3>
                <div id="res-advice" style="background:#f9f9f9; padding:15px; border-radius:10px; text-align:left; margin:15px 0; border-left:4px solid var(--primary);">Loading...</div>
                <button class="btn-main" onclick="goHome()" id="btn-home">Home</button>
            </div>
        </div>
    </div>

    <div id="settings" class="modal">
        <div class="modal-head"><span id="h_lang">Language</span> <i class="fas fa-times" onclick="closeModal('settings')"></i></div>
        <div class="modal-body">
            <button class="btn-main" style="background:white; color:#333; border:1px solid #ddd;" onclick="setLang('en')">English</button>
            <button class="btn-main" style="background:white; color:#333; border:1px solid #ddd;" onclick="setLang('si')">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</button>
            <button class="btn-main" style="background:white; color:#333; border:1px solid #ddd;" onclick="setLang('ta')">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
        </div>
    </div>

    <div id="models" class="modal">
        <div class="modal-head"><span id="h_models">Model</span> <i class="fas fa-times" onclick="closeModal('models')"></i></div>
        <div class="modal-body">
            <p id="txt-model-inst">Choose advisor:</p>
            <div class="card" onclick="setModel('friend')" style="margin-bottom:10px; background:#FF9A9E; color:white;"><i class="fas fa-user-friends" style="color:white;"></i><span id="m-friend">Friend (Kind)</span></div>
            <div class="card" onclick="setModel('teacher')" style="margin-bottom:10px; background:#a1c4fd; color:white;"><i class="fas fa-chalkboard-teacher" style="color:white;"></i><span id="m-teacher">Teacher (Strict)</span></div>
            <div class="card" onclick="setModel('zen')" style="margin-bottom:10px; background:#84fab0; color:white;"><i class="fas fa-spa" style="color:white;"></i><span id="m-zen">Zen (Calm)</span></div>
        </div>
    </div>

    <div id="game" class="modal">
        <div class="modal-head"><span id="h_game">Tic Tac Toe</span> <i class="fas fa-times" onclick="closeModal('game')"></i></div>
        <div class="modal-body" style="text-align:center;">
            <h2 id="ttt-msg">Your Turn (X)</h2>
            <div class="ttt-board" id="ttt-board"></div>
            <button class="btn-main" onclick="initTTT()" id="btn-restart">Restart</button>
        </div>
    </div>

    <div id="todo" class="modal"><div class="modal-head"><span id="h_todo">Tasks</span> <i class="fas fa-times" onclick="closeModal('todo')"></i></div><div class="modal-body"><input id="t-in"><button class="btn-main" onclick="addTodo()">+</button><div id="t-list" style="margin-top:10px;"></div></div></div>
    <div id="timer" class="modal"><div class="modal-head"><span id="h_timer">Timer</span> <i class="fas fa-times" onclick="closeModal('timer')"></i></div><div class="modal-body" style="text-align:center;"><h1 id="time-disp" style="font-size:4rem;margin:30px 0;">25:00</h1><button class="btn-main" onclick="startTimer()">Start</button><button class="btn-main" style="background:#f44336" onclick="resetTimer()">Reset</button></div></div>
    <div id="sleep" class="modal"><div class="modal-head"><span id="h_sleep">Sleep</span> <i class="fas fa-times" onclick="closeModal('sleep')"></i></div><div class="modal-body"><input type="time" id="wake-time"><button class="btn-main" onclick="calcSleep()">Calc</button><h3 id="sleep-res" style="text-align:center;margin-top:20px;"></h3></div></div>
    <div id="journal" class="modal"><div class="modal-head"><span id="h_journal">Journal</span> <i class="fas fa-times" onclick="closeModal('journal')"></i></div><div class="modal-body"><textarea id="j-txt" rows="10"></textarea><button class="btn-main" onclick="alert('Saved')">Save</button></div></div>
    <div id="draw" class="modal"><div class="modal-head"><span id="h_draw">Draw</span> <i class="fas fa-times" onclick="closeModal('draw')"></i></div><div class="modal-body"><canvas id="canvas" width="300" height="400" style="border:1px solid #ccc;"></canvas><button class="btn-main" onclick="ctx.clearRect(0,0,300,400)" style="background:#f44336">Clear</button></div></div>
    <div id="breath" class="modal"><div class="modal-head"><span id="h_breath">Breathe</span> <i class="fas fa-times" onclick="closeModal('breath')"></i></div><div class="modal-body"><div style="width:150px;height:150px;background:#4A90E2;border-radius:50%;margin:50px auto;animation:breathe 4s infinite;"></div></div></div>
    <div id="bmi" class="modal"><div class="modal-head">BMI <i class="fas fa-times" onclick="closeModal('bmi')"></i></div><div class="modal-body"><input id="w" placeholder="Kg"><input id="h" placeholder="Cm"><button class="btn-main" onclick="calcBMI()">Check</button><h2 id="bmi-res" style="text-align:center;"></h2></div></div>
    <div id="exam" class="modal"><div class="modal-head"><span id="h_exam">Exam</span> <i class="fas fa-times" onclick="closeModal('exam')"></i></div><div class="modal-body"><input type="date" id="e-date"><button class="btn-main" onclick="calcExam()">Calc</button><h2 id="e-res" style="text-align:center;"></h2></div></div>

</div>

<script>
    // --- TRANSLATIONS ---
    const dict = {
        en: {
            greet:"Hi Student! üëã", btn_start:"Start Analysis", btn_home:"Home",
            l_game:"Tic Tac AI", l_todo:"Tasks", l_timer:"Pomodoro", l_sleep:"Sleep", l_journal:"Journal", l_draw:"Draw", l_breath:"Breathe", l_bmi:"BMI", l_exam:"Exam", l_lang:"Language",
            h_models:"Select Model", txt_model_inst:"Choose advisor:", m_friend:"Friend (Kind)", m_teacher:"Teacher (Strict)", m_zen:"Zen (Calm)",
            h_game:"Tic Tac Toe", h_todo:"Tasks", h_timer:"Timer", h_sleep:"Sleep", h_journal:"Journal", h_draw:"Draw", h_breath:"Breathe", h_exam:"Exam", h_lang:"Language",
            q_arr: ["Kindly rate your Sleep Quality? üò¥", "How often do you get headaches? ü§ï", "Rate your Academic Performance? üìä", "How heavy is your Study Load? üìö", "Do you do Extracurricular Activities? ‚öΩ"],
            res_norm:"Normal", res_stress:"High Stress",
            adv_f_good:"Awesome! Life is good! üéâ", adv_f_bad:"Oh no! Need a break? ü§ó",
            adv_t_good:"Good. Keep studying. üìö", adv_t_bad:"Focus! Re-plan your day. üìè",
            adv_z_good:"Peaceful mind. üå∏", adv_z_bad:"Breathe deeply. üßò",
            ttt_turn:"Your Turn (X)", ttt_win:"You Win!", ttt_lose:"AI Wins!", ttt_draw:"Draw!", btn_restart:"Restart"
        },
        si: {
            greet:"‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä! üëã", btn_start:"‡∑Ä‡∑í‡∑Å‡∑ä‡∂Ω‡∑ö‡∑Ç‡∂´‡∂∫", btn_home:"‡∂∏‡∑î‡∂Ω‡∑ä ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä",
            l_game:"‡∂ß‡∑í‡∂ö‡∑ä ‡∂ß‡∑ê‡∂ö‡∑ä", l_todo:"‡∑Ä‡∑ê‡∂©", l_timer:"‡∂ß‡∂∫‡∑í‡∂∏‡∂ª‡∑ä", l_sleep:"‡∂±‡∑í‡∂±‡∑ä‡∂Ø", l_journal:"‡∂Ø‡∑í‡∂±‡∂¥‡∑ú‡∂≠", l_draw:"‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª", l_breath:"‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏", l_bmi:"BMI", l_exam:"‡∑Ä‡∑í‡∂∑‡∑è‡∂ú", l_lang:"‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä",
            h_models:"AI ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±", txt_model_inst:"‡∂ã‡∂¥‡∂Ø‡∑ô‡∑É‡∑ä ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±‡∑ö:", m_friend:"‡∂∫‡∑è‡∂Ω‡∑î‡∑Ä‡∑è", m_teacher:"‡∂ú‡∑î‡∂ª‡∑î‡∑Ä‡∂ª‡∂∫‡∑è", m_zen:"Zen ‡∂ú‡∑î‡∂ª‡∑î",
            h_game:"‡∂ß‡∑í‡∂ö‡∑ä ‡∂ß‡∑ê‡∂ö‡∑ä ‡∂ß‡∑ù", h_todo:"‡∑Ä‡∑ê‡∂© ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä", h_timer:"‡∂ß‡∂∫‡∑í‡∂∏‡∂ª‡∑ä", h_sleep:"‡∂±‡∑í‡∂±‡∑ä‡∂Ø", h_journal:"‡∂Ø‡∑í‡∂±‡∂¥‡∑ú‡∂≠", h_draw:"‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª", h_breath:"‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏", h_exam:"‡∑Ä‡∑í‡∂∑‡∑è‡∂ú", h_lang:"‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä",
            q_arr: ["‡∂±‡∑í‡∂±‡∑ä‡∂Ø‡∑ö ‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∂ö‡∑ú‡∑Ñ‡∑ú‡∂∏‡∂Ø? üò¥", "‡∑Ñ‡∑í‡∑É‡∂ª‡∂Ø‡∂∫ ‡∑Ñ‡∑ê‡∂Ø‡∑ô‡∂±‡∑Ä‡∑è‡∂Ø? ü§ï", "‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂± ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏ ‡∑Ñ‡∑ú‡∂≥‡∂Ø? üìä", "‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∂∂‡∂ª ‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø? üìö", "‡∑Ä‡∑í‡∂±‡∑ù‡∂Ø‡∑è‡∂Ç‡∑Å ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è‡∂Ø? ‚öΩ"],
            res_norm:"‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‚Äç‡∂∫‡∂∫‡∑í", res_stress:"‡∂Ü‡∂≠‡∂≠‡∑í‡∂∫",
            adv_f_good:"‡∂±‡∑í‡∂∫‡∂∏‡∂∫‡∑í! ‡∑É‡∂≠‡∑î‡∂ß‡∑í‡∂±‡∑ä ‡∂â‡∂±‡∑ä‡∂±! üéâ", adv_f_bad:"‡∂Ö‡∂∫‡∑í‡∂∫‡∑ù! ‡∑Ä‡∑í‡∑Ä‡∑ö‡∂ö‡∂∫‡∂ö‡∑ä ‡∂ú‡∂∏‡∑î. ü§ó",
            adv_t_good:"‡∑Ñ‡∑ú‡∂≥‡∂∫‡∑í. ‡∂Ø‡∑í‡∂ú‡∂ß‡∂∏ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. üìö", adv_t_bad:"‡∂ö‡∑è‡∂Ω‡∑É‡∂ß‡∑Ñ‡∂± ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. üìè",
            adv_z_good:"‡∂∏‡∂±‡∑É ‡∑É‡∑ê‡∑Ñ‡∑ê‡∂Ω‡∑ä‡∂Ω‡∑î‡∂∫‡∑í. üå∏", adv_z_bad:"‡∂ú‡∑ê‡∂π‡∑î‡∂ª‡∑í‡∂±‡∑ä ‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏ ‡∂ú‡∂±‡∑ä‡∂±. üßò",
            ttt_turn:"‡∂î‡∂∂‡∑ö ‡∑Ä‡∑è‡∂ª‡∂∫", ttt_win:"‡∂î‡∂∂ ‡∂Ø‡∑í‡∂±‡∑î‡∑Ä‡∑è!", ttt_lose:"AI ‡∂Ø‡∑í‡∂±‡∑î‡∑Ä‡∑è!", ttt_draw:"‡∑É‡∂∏‡∂∫‡∑í!", btn_restart:"‡∂±‡∑ê‡∑Ä‡∂≠"
        },
        ta: {
            greet:"‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! üëã", btn_start:"‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç", btn_home:"‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ",
            l_game:"‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ", l_todo:"‡Æµ‡Øá‡Æ≤‡Øà", l_timer:"‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç", l_sleep:"‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç", l_journal:"‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ", l_draw:"‡Æì‡Æµ‡Æø‡ÆØ‡ÆÆ‡Øç", l_breath:"‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ", l_bmi:"BMI", l_exam:"‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", l_lang:"‡ÆÆ‡Øä‡Æ¥‡Æø",
            h_models:"AI ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", txt_model_inst:"‡ÆÜ‡Æ≤‡Øã‡Æö‡Æï‡Æ∞‡Øç:", m_friend:"‡Æ®‡Æ£‡Øç‡Æ™‡Æ∞‡Øç", m_teacher:"‡ÆÜ‡Æö‡Æø‡Æ∞‡Æø‡ÆØ‡Æ∞‡Øç", m_zen:"‡Æú‡ØÜ‡Æ©‡Øç",
            h_game:"‡Æü‡Æø‡Æï‡Øç ‡Æü‡Ææ‡Æï‡Øç ‡Æü‡Øã", h_todo:"‡Æµ‡Øá‡Æ≤‡Øà‡Æï‡Æ≥‡Øç", h_timer:"‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç", h_sleep:"‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç", h_journal:"‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ", h_draw:"‡Æì‡Æµ‡Æø‡ÆØ‡ÆÆ‡Øç", h_breath:"‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ", h_exam:"‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", h_lang:"‡ÆÆ‡Øä‡Æ¥‡Æø",
            q_arr: ["‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø? üò¥", "‡Æ§‡Æ≤‡Øà‡Æµ‡Æ≤‡Æø ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡Ææ? ü§ï", "‡Æï‡Æ≤‡Øç‡Æµ‡Æø ‡Æ®‡Æø‡Æ≤‡Øà? üìä", "‡Æ™‡Æü‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æö‡ØÅ‡ÆÆ‡Øà? üìö", "‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ? ‚öΩ"],
            res_norm:"‡Æö‡Ææ‡Æ§‡Ææ‡Æ∞‡Æ£‡ÆÆ‡Øç", res_stress:"‡ÆÖ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç",
            adv_f_good:"‡Æ®‡Æ©‡Øç‡Æ±‡ØÅ! ‡ÆÆ‡Æï‡Æø‡Æ¥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç! üéâ", adv_f_bad:"‡Æì‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æé‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. ü§ó",
            adv_t_good:"‡Æ®‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ. ‡Æ™‡Æü‡Æø‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. üìö", adv_t_bad:"‡Æï‡Æµ‡Æ©‡ÆÆ‡Øç ‡Æ§‡Øá‡Æµ‡Øà. üìè",
            adv_z_good:"‡ÆÖ‡ÆÆ‡Øà‡Æ§‡Æø. üå∏", adv_z_bad:"‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ ‡Æµ‡Æø‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. üßò",
            ttt_turn:"‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æ±‡Øà", ttt_win:"‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø!", ttt_lose:"AI ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø!", ttt_draw:"‡Æö‡ÆÆ‡ÆÆ‡Øç!", btn_restart:"‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç"
        }
    };

    let lang = 'en', currentModel = 'friend';
    let qAnswers = [];

    function goHome() { document.querySelectorAll('.view').forEach(v=>v.classList.remove('active')); document.getElementById('view-home').classList.add('active'); }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; if(id=='game') initTTT(); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function showView(id) { document.querySelectorAll('.view').forEach(v=>v.classList.remove('active')); document.getElementById(id).classList.add('active'); }

    function setLang(l) {
        lang = l;
        let d = dict[l];
        document.getElementById('greet').innerText = d.greet;
        document.getElementById('btn-start').innerText = d.btn_start;
        document.getElementById('btn-home').innerText = d.btn_home;
        ['game','todo','timer','sleep','journal','draw','breath','bmi','exam','lang'].forEach(k => document.getElementById('l_'+k).innerText = d['l_'+k]);
        ['models','game','todo','timer','sleep','journal','draw','breath','exam','lang'].forEach(k => { if(document.getElementById('h_'+k)) document.getElementById('h_'+k).innerText = d['h_'+k]; });
        document.getElementById('txt-model-inst').innerText = d.txt_model_inst;
        document.getElementById('m-friend').innerText = d.m_friend;
        document.getElementById('m-teacher').innerText = d.m_teacher;
        document.getElementById('m-zen').innerText = d.m_zen;
        document.getElementById('ttt-msg').innerText = d.ttt_turn;
        document.getElementById('btn-restart').innerText = d.btn_restart;
        closeModal('settings');
    }

    function setModel(m) {
        currentModel = m;
        document.body.className = 'model-' + m;
        let d = dict[lang];
        let name = m==='friend'?d.m_friend : m==='teacher'?d.m_teacher : d.m_zen;
        document.getElementById('model-disp').innerText = name;
        closeModal('models');
    }

    // --- TIC TAC TOE AI ---
    let board = Array(9).fill(null), gameActive = true;
    function initTTT() { board.fill(null); gameActive = true; renderTTT(); document.getElementById('ttt-msg').innerText = dict[lang].ttt_turn; }
    function renderTTT() {
        let b = document.getElementById('ttt-board'); b.innerHTML='';
        board.forEach((c, i) => {
            let d = document.createElement('div'); d.className = 'ttt-cell ' + (c ? 'taken' : '');
            d.innerText = c || ''; d.onclick = () => playerMove(i);
            b.appendChild(d);
        });
    }
    function playerMove(i) {
        if(!gameActive || board[i]) return;
        board[i] = 'X'; renderTTT();
        if(checkWin('X')) { endGame(dict[lang].ttt_win); return; }
        if(!board.includes(null)) { endGame(dict[lang].ttt_draw); return; }
        setTimeout(aiMove, 500);
    }
    function aiMove() {
        if(!gameActive) return;
        let empty = board.map((v, i) => v === null ? i : null).filter(v => v !== null);
        board[empty[Math.floor(Math.random() * empty.length)]] = 'O'; renderTTT();
        if(checkWin('O')) { endGame(dict[lang].ttt_lose); return; }
        if(!board.includes(null)) { endGame(dict[lang].ttt_draw); return; }
    }
    function checkWin(p) { return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(c => board[c[0]]==p && board[c[1]]==p && board[c[2]]==p); }
    function endGame(msg) { gameActive = false; document.getElementById('ttt-msg').innerText = msg; }

    // --- SMART STRESS LOGIC ---
    let qStep=0;
    function startCheckup() { qStep=0; qAnswers=[]; showView('view-quiz'); loadQ(); }
    function loadQ() { document.getElementById('q-text').innerText = dict[lang].q_arr[qStep]; }
    function speakQ() { 
        let txt = document.getElementById('q-text').innerText;
        let u = new SpeechSynthesisUtterance(txt);
        // Sinhala/Tamil TTS might not work in all browsers, defaults to English voice reading the text
        window.speechSynthesis.speak(u);
    }
    function answer(v) {
        qAnswers.push(v); qStep++;
        if(qStep < 5) loadQ();
        else finishQuiz();
    }
    function finishQuiz() {
        showView('view-result');
        // Logic: 
        // 1. Sleep (High=Good) -> Reverse (5-v)
        // 2. Headache (High=Bad) -> Direct (v)
        // 3. Academic (High=Good) -> Reverse (5-v)
        // 4. Load (High=Bad) -> Direct (v)
        // 5. Extra (High=Good) -> Reverse (5-v)
        let s = (5-qAnswers[0]) + qAnswers[1] + (5-qAnswers[2]) + qAnswers[3] + (5-qAnswers[4]);
        let pct = Math.round((s/25)*100);
        
        document.getElementById('res-score').innerText = pct + "%";
        
        let d = dict[lang];
        let good = pct < 50;
        let advice = "";
        
        if(currentModel === 'friend') advice = good ? d.adv_f_good : d.adv_f_bad;
        else if(currentModel === 'teacher') advice = good ? d.adv_t_good : d.adv_t_bad;
        else advice = good ? d.adv_z_good : d.adv_z_bad;
        
        document.getElementById('res-advice').innerText = advice;
        document.getElementById('res-status').innerText = good ? d.res_norm : d.res_stress;
    }

    // --- FEATURES ---
    function addTodo() { let v=document.getElementById('t-in').value; if(v){document.getElementById('t-list').innerHTML+=`<div class='todo-item'>${v} <i class='fas fa-trash' onclick='this.parentElement.remove()'></i></div>`; document.getElementById('t-in').value='';} }
    let tInt, tTime=1500;
    function startTimer(){ if(!tInt) tInt=setInterval(()=>{ tTime--; let m=Math.floor(tTime/60),s=tTime%60; document.getElementById('time-disp').innerText=`${m}:${s<10?'0'+s:s}`; if(tTime<=0)resetTimer(); },1000); }
    function resetTimer(){ clearInterval(tInt); tInt=null; tTime=1500; document.getElementById('time-disp').innerText="25:00"; }
    function calcSleep(){ let t=document.getElementById('wake-time').value; if(t){ let d=new Date("2000-01-01 "+t); d.setMinutes(d.getMinutes()-450); document.getElementById('sleep-res').innerText=d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); } }
    function calcBMI(){ let w=document.getElementById('w').value, h=document.getElementById('h').value; if(w&&h) document.getElementById('bmi-res').innerText="BMI: "+(w/((h/100)**2)).toFixed(1); }
    function calcExam(){ let d=new Date(document.getElementById('e-date').value); let diff=Math.ceil((d-new Date())/(1000*60*60*24)); document.getElementById('e-res').innerText=diff+" Days"; }
    
    const ctx = document.getElementById('canvas').getContext('2d');
    let paint=false;
    function draw(e){ if(!paint)return; e.preventDefault(); let r=e.target.getBoundingClientRect(); let x=(e.clientX||e.touches[0].clientX)-r.left, y=(e.clientY||e.touches[0].clientY)-r.top; ctx.lineTo(x,y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x,y); }
    const cvs = document.getElementById('canvas');
    cvs.addEventListener('mousedown',()=>{paint=true}); cvs.addEventListener('mouseup',()=>{paint=false;ctx.beginPath()}); cvs.addEventListener('mousemove',draw);
    cvs.addEventListener('touchstart',(e)=>{paint=true;draw(e)}); cvs.addEventListener('touchend',()=>{paint=false;ctx.beginPath()}); cvs.addEventListener('touchmove',draw);

    document.styleSheets[0].insertRule(`@keyframes breathe { 0%,100% {transform:scale(1)} 50% {transform:scale(1.5)} }`,0);
</script>
</body>
</html>
